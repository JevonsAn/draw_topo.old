<!DOCTYPE html>
<html>
<head>
	<title>自治域拓扑图</title>
	<link href="static/bootstrap.css" rel="stylesheet">
</head>
<body>
	<!--<p style="color: red;font-size: 20px;">try</p>-->
	<svg id="topo" width="1450" height="7000">
	 
	</svg>
</body>
<script src="static/jquery-3.3.1.min.js"></script>
<script src="static/bootstrap.js"></script>
<script src="static/d3.js"></script>
<script src="static/d3-selection-multi.v1.js"></script>
<script>
	let svg = d3.select("svg#topo");
	let height = 400;
	let width = 600;
	let x = d3.scaleOrdinal().range({{x_list}});
	let xScale = x.domain({% raw x_domain%});

	// x轴
	let xAxis = svg.append('g')
				   .attr('class', 'xAxisis')
				   .attr('transform', `translate(0, 50)`)
				   .call(d3.axisTop(xScale))
		            .append("text")//添加坐标轴说明
					.text("经度")
					.attr("transform","translate(1350,0)")
					.attr("fill","#000")
					.attr("font-size", "20px")
					.attr("dy","0em");

	let x2 = d3.scaleOrdinal().range({{x_list2}});
	let xScale2 = x2.domain({% raw x_domain2%});

	// x轴
	let xAxis2 = svg.append('g')
				   .attr('class', 'xAxisis')
				   .attr('transform', `translate(0, 25)`)
				   .call(d3.axisTop(xScale2));
                    // .append("text")//添加坐标轴说明
					// .text("经度")
					// .attr("transform","translate(1350,0)")
					// .attr("fill","#000")
					// .attr("font-size", "20px")
					// .attr("dy","0em");

	let y = d3.scaleOrdinal().range([0,600]);
	let yScale = y.domain(["", ""]);

	// y轴
	let yAxis = svg.append('g')
				   .attr('class', 'yAxisis')
				   .attr('transform', `translate(100, 50)`)
				   .call(d3.axisLeft(yScale));
					// .append("text")//添加坐标轴说明
					// .text("经度")
					// .attr("transform","translate(1350,0)")
					// .attr("fill","#000");

	d3.json("json", function(error, graph) {
    if (error) throw error;

    let node = svg.selectAll(".node")
                  .data(graph)
                .enter().append("g")
                  .attr("class", "node")
                  .attr("id",function (d) {
                    return "node"+d.asn;
                  });

    node.append("rect")
        .attr("stroke", d => d.color)
        .attr("stroke-width","0px")
        .attr("fill", d => d.color)
        .attr("x", d => d.xp)
        .attr("y", d => d.yp)
        .attr("width", d => d.width)
        .attr("height", d => d.height)
        .on("click",function(d) {
          
        });
        // .call(d3.drag()
        //     .on("start", dragstarted)
        //     .on("drag", dragged)
        //     .on("end", dragended));

    node.append("text")
            // .attr("dx", 0)
            // .attr("dy", ".35em")
            .attr("x", d => d.xp + d.width/2)
            .attr("y", d => d.yp + 4 + d.height/2)
            .attr("style","background-color:white;opacity:1;") //
            .style("text-anchor", "middle")
            .style("fill", "#111")
            .style("font-family", "Arial")
            .style("font-size", d => d.height * 0.7)
            .text(d => d.asn);


    node.append("title")
        .text(d => `自治域号：${d.asn}
                    自治域名称：${d.name.split(',')[1]}
                    所在国家：${d.name.split(',')[2]}
                    customer数量：${d.scale}`);

    // node.append("text")
    //     .attr("dx", 0)
    //     .attr("dy", ".35em")
    //     .attr("id", function(d) {
    //       return "text"+d.id;
    //     })
    //     .attr("style","background-color:white;opacity:1;")
    //     .style("text-anchor", "middle")
    //     .style("fill", "#444")
    //     .style("font-family", "Arial")
    //     .style("font-size", 9)
    //     .text(function(d) {
    //       return d.ASN;
    //     })
    //     .call(getBB);
  });

</script>
</html>